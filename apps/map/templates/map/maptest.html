{% load static %}
<!DOCTYPE html>
<html>
<head>
    <!-- Standard Meta -->
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.css">
    <!-- Site Properties -->
    <title>Theming - Semantic</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"/>
    <style>
        body > .ui.container {
            margin-top: 3em;
        }

        #map {
            width: 60%;
            height: 70em;
            margin: 0 auto;
        }

        #topbar {
            margin-bottom: 2em;
            padding: 1em;
        }
    </style>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"></script>

</head>
<body>
<div class="ui stackable menu">
    <div class="item">
        <img src="https://semantic-ui.com/images/logo.png">
    </div>
    <a class="item active" href="{% url 'map-test' %}">Home</a>
    <a class="item" href="{% url 'map-test-saved-searches' %}">Zapisane wyszukiwania</a>
</div>
<div class="ui container ">
    <div id="topbar">
        <div class="ui left aligned stackable grid container">
            <div class="row">
                <div class="ui big icon input">
                    <input type="text" placeholder="Search big...">
                    <i class="search icon"></i>
                </div>
            </div>
            <div class="row">
                <button class="ui green large button">
                    <i class="fa-solid fa-basket-shopping icon"></i>
                    Sklepy (<span id="shops_count"></span>)
                </button>
                <button class="ui toggle yellow large button">
                    <i class="utensils icon"></i>
                    Restauracje (13)
                </button>
                <button class="ui black toggle large button">
                    <i class="fa-solid fa-building-columns icon"></i>
                    Aktywno≈õci (6)
                </button>
            </div>
            <div class="row">
                <div class="ui icon buttons">
                    <button class="ui medium button distance" data-distance="1">
                        <i class="circle outline icon"></i>
                        1 km
                    </button>
                    <button class="ui medium button distance active" data-distance="2">
                        <i class="circle outline icon"></i>
                        2 km
                    </button>
                    <button class="ui medium button distance" data-distance="3">
                        <i class="circle outline icon"></i>
                        3 km
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="map"></div>
<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoia2FtaWxiOTYxMCIsImEiOiJjbTRtaDE4dWIwNHphMndxc3F2NWJmNmw1In0.HqebzlQEy9WPPxw3Fb_ntQ';
    const map = new mapboxgl.Map({
        style: 'mapbox://styles/kamilb9610/cm4oif82n001e01qy95ou2yxk',
        container: 'map', // container ID
        center: [21.0456641, 52.1942434], // starting position [lng, lat]. Note that lat must be set between -90 and 90
        zoom: 13, // starting zoom,
    });
    const BASE_URL = "http://localhost:8080/map/find_points/?distance=2&category=shop,leisure,religion&lat=52.1942434&long=21.0456641"
    map.on('load', function () {

        var center = [21.0456641, 52.1942434];
        var radiusTwo = 2;
        var options = {steps: 200, units: 'kilometers', properties: {foo: 'bar'}};
        var circle = turf.circle(center, radiusTwo, options);

        map.addLayer({
            "id": "circle",
            "type": "fill",
            "dynamic": true,
            "source": {
                "type": "geojson",
                "data": circle,
                "lineMetrics": true,
            },
            "paint": {
                "fill-color": "#b36d05",
                "fill-antialias": true,
                "fill-opacity": 0.1,
            },
            "layout": {}
        });


        map.addLayer({
            'id': 'circle-outline',
            'type': 'line',
            'source': {
                'type': 'geojson',
                'data': circle,
                "lineMetrics": true,
            },
            'paint': {
                'line-color': '#d69431',
                'line-width': 3,
                'line-opacity': 0.4,
            }
        });


        map.addControl(new mapboxgl.NavigationControl({showCompass: false}));
    });


    map.on('load', () => {
        // Add a GeoJSON source with 2 points
        map.addSource('points', {
            type: 'geojson',
            // Use a URL for the value for the `data` property.
            data: BASE_URL,
        });

        // Add a symbol layer
        map.addLayer({
            'id': 'points',
            'type': 'symbol',
            'source': 'points',
            'layout': {
                'icon-image': [
                    'match',
                    ['get', 'category'],
                    'shop',
                    'cart1',
                    'religion',
                    'cross1',
                    'leisure',
                    'building-columns-solid',
                    "#cecece"
                ],
                'text-field': ['get', 'name'],

                'text-font': [
                    'Open Sans Regular',
                    'Arial Unicode MS Regular'
                ],
                "text-size": 11,
                'text-offset': [0, 1.25],
                'text-anchor': 'top'
            }
        });

        // Add a GeoJSON source with 2 points
        map.addSource('main_point', {
            'type': 'geojson',
            'data': {
                'type': 'FeatureCollection',
                'features': [
                    {
                        // feature for Mapbox SF
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Point',
                            'coordinates': [21.0456641, 52.1942434]
                        },
                        'properties': {
                            'title': 'Mapbox SF'
                        }
                    }
                ]
            }
        });

        // Add a symbol layer
        map.addLayer({
            'id': 'main_point',
            'type': 'symbol',
            'source': 'main_point',
            'layout': {
                'icon-image': 'utensils1',

            }
        });

    });

</script>
<script src="{% static 'js/distance_resize.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.js"></script>
</body>
</html>
